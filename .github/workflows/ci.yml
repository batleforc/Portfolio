name: ci master
on:
  push:
    branches:
      - "master"
    tags:
      - "v*.*.*"

jobs:
  ci-master: 
    runs-on: ubuntu-latest
    steps:
      - uses : actions/checkout@v2
      - uses : actions/setup-node@v1
        with : 
          node-versions: '14'
      - run : npm ci
      - run : npm run build
  deploy:
    runs-on: [self-hosted, linux]
    steps:
      - uses : actions/checkout@v2
      - run : pwd
      - run : echo "$test" > ./API/Config.all.js
        shell : bash
        env:
          test: ${{secrets.TEST}}
      - run : docker build -t batlefroc/portfolio . 
      - run : docker container stop ${{secrets.CONTAINER_NAME}}
      - run : docker container rm portfolio
      - run : docker run -p 8080:8080 -d --network weebo --name ${{secrets.CONTAINER_NAME}} batlefroc/portfolio
      - run : docker logs portfolio 